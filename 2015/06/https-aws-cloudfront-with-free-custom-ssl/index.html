<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>AWS https CloudFront with Free Custom SSL</title>
    <meta name="description" content="Ashish Pandey - Amused at technology" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- [[! highlight.js ]] -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Ashish Pandey" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Ashish Pandey" />
    <meta property="og:description" content="Amused at technology" />
    <meta property="og:url" content="/" />
    <meta property="og:image" content="/assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Ashish Pandey" />
    <meta name="twitter:description" content="Amused at technology" />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image:src" content="/assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Ashish Pandey",
    "url": "/",
    "image": "/assets/images/cover1.jpg",
    "description": "Amused at technology"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Ashish Pandey" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-author " role="presentation"><a href="/author/ashishapy">Author</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>

    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/cover8.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/logofh.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-test tag-content">

        <header class="post-header">
            <h1 class="post-title">AWS https CloudFront with Free Custom SSL</h1>
            <section class="post-meta">
             <a href='/author/ashishapy'>Ashish Pandey</a> 
            <time class="post-date" datetime="2015-06-13">13 Jun 2015</time>
                <!-- [[tags prefix=" on "]] -->
                 
                on 
                
                    
                       <a href='/tag/AWS'>Aws</a>,
                       
                
                    
                       <a href='/tag/SSL'>Ssl</a>
                       
                
                
            </section>
        </header>

        <br>
        
        <section class="post-content">
            
            <p>I wanted to deliver images on my website through a secure CDN (in case of AWS, it is CloudFront) to improve performance of my website.</p>

<hr />
<p><strong>Synopsis:</strong> 
It’s covered in 4 steps.</p>

<ol>
  <li>Get class 1 free SSL from StartSSL</li>
  <li>Upload certificate to aws for CloudFront</li>
  <li>Configure Secure CloudFront to deliver images stored on AWS S3 bucket.</li>
  <li>Setup Route 53 to use cdn subdomain with CloudFront</li>
</ol>

<hr />
<p>But since I have enabled HTTP Strict Transport Security (HSTS) for all my website subdomains.</p>

<p>==add_header Strict-Transport-Security “max-age=31536000; includeSubdomains;”;==</p>

<p>It allows web servers to declare that web browsers (or other complying user agents) should only interact with it using secure HTTPS connections, and never via the insecure HTTP protocol.
After enabling HTTPS my domain is not allowed to serve images over http.</p>

<p><strong>Step 1</strong>: 
Let’s get a free SSL first.
I got SSL for my domain https://ashishapy.com and one sub domain https://www.ashishapy.com for free. Check my other blog <a href="https://blog.ashishapy.com/part-12-get-ssl-certificate-free/">get-ssl-certificate-free</a> to know, how to get it. 
Now I want another subdomain https://cdn.ashishapy.com to be served using SSL. Free SSL allows to add only one subdomain along with root domain.</p>

<p>I had two options
A. Go for costly and exhaustive process to get class 2 SSL to add more than one subdomain.
B. Or Get another Class 1 SSL Free for subdomain cdn.ashishapy.com.</p>

<p>Being an individual blogger, I wanted to go for cheapest option without compromising security. I choose option 2, get it using same process explained <a href="https://blog.ashishapy.com/part-12-get-ssl-certificate-free/">get-ssl-certificate-free</a>. 
I have three files Private Key (cdn_ssl_private.key), Certificate (cdn_ssl.crt) and intermediate CA certificate (sub.class1.server.ca.pem)</p>

<p><strong>Step 2</strong>: 
Upload these files to AWS. You are gonna need AWS command line tool. If you haven’t already installed it then follow <a href="http://docs.aws.amazon.com/cli/latest/userguide/installing.html">AWS cli installtion guide</a>.
you need to associate your Amazon Access key and ID by running 
<code>aws configure</code></p>

<p>Once AWS cli tool configured, upload the certificate to AWS using following command.</p>

<p><code>aws iam upload-server-certificate --server-certificate-name cdnashishpy --certificate-body file://cdn-ssl.crt --private-key file://cdn_ssl_private.key --certificate-chain file://sub.class1.server.ca.pem --path /cloudfront/</code></p>

<p>I named certificate name as ‘cdnashishapy’, please use your own name to recognise easily in future.
The extra –-path /cloudfront/ to let Amazon know we will be using this on CloudFront otherwise certificate won’t show for CloudFront.</p>

<p>Test it, if all is well by running command 
<code>aws iam get-server-certificate --server-certificate-name cdnashishapy</code>
It should return uploaded certificate information.</p>

<p><strong>Step 3</strong>:
Sign in to your AWS account and go to <a href="https://console.aws.amazon.com/cloudfront/home">CloudFront home</a>.
<img src="//cdn.ashishapy.com/2015/Jun/1cf-1434176197004.jpg" alt="CloudFront home" />
Click on ‘Create Distribution’.</p>

<p><img src="//cdn.ashishapy.com/2015/Jun/2cf-1434176975683.jpg" alt="Select Web" />
In ‘Web’ section click on ‘Get Started’ button</p>

<p>In the next screen fill ‘Origin Settings’ &amp; ‘Default Cache Behaviour Settings’ as below screen shot.</p>

<p>Origin Settings:
<img src="//cdn.ashishapy.com/2015/Jun/3cf-1434177785313.jpg" alt="Origin Settings" />
I choose a S3 bucket as origin. This should be your source of content.</p>

<p>Default Cache Behaviour Settings:
<img src="//cdn.ashishapy.com/2015/Jun/4cf-1434178088818.jpg" alt="Default Cache Behaviour Settings" /></p>

<p>Distribution Settings:
Here comes the critical part of the setup.
<img src="//cdn.ashishapy.com/2015/Jun/5cf-1434178922019.jpg" alt="Distribution Settings" /></p>

<p>Price Class: Choose it based on your most users’ geolocation.
Alternate Domain Names (CNAMEs): Give your cdn subdomain name.
SSL Certificate: Select Custom SSL Certificate and choose certificate name from drop down option.</p>

<p>==Custom SSL Client Support: I choose ‘Only Clients that Support Server Name Indication (SNI)’. This option limits the browsers you can serve. Check what browser supports SNI.
Mostly, it’s not supported in IE at all on Windows XP and earlier and Android 2.2 default browser. Still recommended to do your own analysis.==
You can choose ‘All Clients’ but there are charges for that.</p>

<p>Click on ‘Create Distribution’ button to create Secure CloudFront Distribution.
<img src="//cdn.ashishapy.com/2015/Jun/6CF-1434181909661.jpg" alt="CloudFront Distribution" />
This will take 15-20 mins to get status as ‘Enabled’.
Copy ‘Domain Name’ value, you will need it to set up DNS in next step.</p>

<p>You are just one step away from setting up you secure CDN.</p>

<p><strong>Step 4</strong>:
Go to your <a href="https://console.aws.amazon.com/route53/home#hosted-zones:">AWS Route53 Hosted Zones</a>.
Create a Record Set.
<img src="//cdn.ashishapy.com/2015/Jun/6cfr53-1434183046874.jpg" alt="Create a Record Set" />
Paste CloudFront DomainName copied from Step 3 in Value.
Save the record set and wait for couple of mins.</p>

<p>Congratulations! You have successfully created a secure CDN.</p>

<p>Please leave your comments here or discuss on Twitter.</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="/author/ashishapy" style="background-image: url(/assets/images/profile.jpg)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="/author/ashishapy">Ashish Pandey</a></h4>
                
                <div class="author-meta">
                    <span class="author-location icon-location"> Bengaluru, India</span> 
                    <span class="author-link icon-link"><a href="https://blog.ashishapy.com/"> blog.ashishapy.com</a></span> 
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=AWS https CloudFront with Free Custom SSL&amp;url=https://blog.ashishapy.com/2015/06/https-aws-cloudfront-with-free-custom-ssl/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.ashishapy.com/2015/06/https-aws-cloudfront-with-free-custom-ssl/"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://blog.ashishapy.com/2015/06/https-aws-cloudfront-with-free-custom-ssl/"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
            
            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/

var disqus_config = function () {
this.page.url = 'https://blog.ashishapy.com//2015/06/https-aws-cloudfront-with-free-custom-ssl/'; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = '/2015/06/https-aws-cloudfront-with-free-custom-ssl/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//ashishapy.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            
            
        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/cover9.jpg)" href="/2015/06/devops-an-introduction-with-automation-tools/">
            <section class="post">
                <h2>DevOps: An Introduction with Automation Tools</h2>
                <p>I have been hearing about DevOps a lot and I thought to check it out,...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/cover8.jpg)" href="/2015/05/create-aws-https-ssl-load-balancer/">
            <section class="post">
                <h2>Create AWS Https / SSL Load Balancer</h2>
                <p>I got class 1 SSL certificate free from StartSSL for my domain. If you are...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Ashish Pandey</a> &copy; 2018</section>
          <section class="poweredby"><a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a></section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-64427924-1', 'auto');
	    ga('send', 'pageview');

     </script>   
</body>
</html>
